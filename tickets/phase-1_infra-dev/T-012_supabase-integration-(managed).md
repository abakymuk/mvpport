# [T-012] Supabase Integration (Managed)

## Обоснование

Supabase даёт готовую auth, хостинг Postgres, storage и edge-functions. Это уменьшает инфраструктурные заботы и ускоряет разработку MVP.

## Область действия

### Входит в scope:

- ✅ Подключение к внешнему проекту Supabase
- ✅ Настройка @supabase/ssr
- ✅ Хранение ключей (anon, service_role) в секретах (не в git)
- ✅ .env.example с SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY
- ✅ Простая проверка — регистрация/вход работает

### Не входит в scope:

- Локальная установка Supabase
- Сложная настройка RLS (будет в T-014)
- Edge functions (будет позже)

## Задачи

### 1. Создание проекта Supabase

**Требования:**

- Создать проект в Supabase Dashboard
- Получить SUPABASE_URL, ANON_KEY, SERVICE_ROLE_KEY
- Настроить базовые настройки проекта

### 2. Настройка клиента в Next.js

**Требования:**

- Установить @supabase/ssr
- Настроить браузерный клиент
- Настроить серверный клиент (service role)
- Создать утилиты для работы с Supabase

### 3. Интеграция аутентификации

**Требования:**

- Настроить auth middleware
- Обновить страницы login/signup
- Добавить защищенные роуты
- Реализовать logout

### 4. Безопасность и конфигурация

**Требования:**

- Настроить переменные окружения
- Обновить .env.example
- Настроить секреты (Doppler/Vault)
- Добавить типы для Supabase

## Критерии приемки

- ✅ Новые пользователи могут зарегистрироваться
- ✅ После логина в Supabase появляется запись
- ✅ Все ключи хранятся в секретах, а не в git
- ✅ Аутентификация работает на всех страницах

## Качество

- ✅ Типизация Supabase клиента
- ✅ Обработка ошибок аутентификации
- ✅ Безопасное хранение ключей
- ✅ Правильная настройка middleware

## Ссылки и заметки

- [Supabase Documentation](https://supabase.com/docs)
- [@supabase/ssr](https://supabase.com/docs/guides/auth/server-side/nextjs)
- [Supabase Auth](https://supabase.com/docs/guides/auth)

## Статус выполнения

- ✅ Проект Supabase создан и настроен
- ✅ @supabase/ssr установлен и настроен
- ✅ Интеграция аутентификации реализована
- ✅ Безопасность настроена
- ✅ **T-012 полностью завершен** ✅
