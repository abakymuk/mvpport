# Исправление рекурсии в RLS политиках

## Проблема

В логах сервера видна ошибка:

```
infinite recursion detected in policy for relation "memberships"
```

Это происходит из-за циклических зависимостей в RLS политиках для таблицы `memberships`.

## Решение (Временное)

### 1. Выполните SQL скрипт в Supabase Dashboard

1. Откройте [Supabase Dashboard](https://supabase.com/dashboard)
2. Перейдите в ваш проект
3. Откройте **SQL Editor**
4. Выполните содержимое файла `supabase/disable-rls-temp.sql`

### 2. Что делает скрипт

- **Отключает** RLS для всех таблиц (временно)
- **Удаляет** все проблемные политики
- **Создает** необходимые функции и триггеры
- **Позволяет** тестировать функциональность без ограничений безопасности

### 3. Тестирование

После выполнения скрипта:

1. **Перезапустите** сервер разработки
2. **Попробуйте создать организацию** в браузере
3. **Проверьте** - создание организаций должно работать

### 4. Включение безопасности обратно

После того как убедитесь, что все работает:

1. Выполните содержимое файла `supabase/enable-rls-after-testing.sql`
2. Это включит RLS обратно с упрощенными политиками

## Альтернативное решение

Если хотите сразу включить безопасность, можете попробовать выполнить `supabase/fix-rls-recursion.sql`, но это может потребовать дополнительных прав в Supabase.

## ВНИМАНИЕ

Отключение RLS временно снимает защиту данных. Используйте только для отладки и обязательно включите обратно после тестирования!
